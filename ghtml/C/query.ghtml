<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Custom Report Generator</title>
</head>
<body>
<!-- Some date utilities, for specifying today's date -->
<?scm
(use-modules (srfi srfi-1) (srfi srfi-19))
(define now-time (current-time))
(define now-date (time-utc->date now-time))
(define now-day-time (date->time-utc (string->date (date->string now-date "~Y ~m ~d") "~Y ~m ~d")))
(define now-month-time (date->time-utc (string->date (string-append (date->string now-date "~Y ~m") " 01") "~Y ~m ~d")))
(define one-day (time-difference (make-time time-utc 0 86400) (make-time time-utc 0 0)))
(define one-short-month (time-difference (make-time time-utc 0 2332800) (make-time time-utc 0 0)))
?>
<center>
<h1>Custom Report Generator</h1>

Run report on
<b>
<?scm (gtt-show-project-title) ?>
 - 
<?scm (gtt-show-project-desc) ?>
</b>

<p>
<FORM METHOD="get" ACTION="status.ghtml">
Run the report 
&nbsp;
<SELECT NAME="report-path">
<OPTION VALUE="journal.ghtml">Journal</OPTION>
<OPTION VALUE="bigtable.ghtml">Big Journal</OPTION>
<OPTION VALUE="invoice.ghtml">Invoice</OPTION>
<OPTION VALUE="daily.ghtml">Daily</OPTION>
<OPTION VALUE="status.ghtml" SELECTED>Status</OPTION>
<OPTION VALUE="todo.ghtml">To Do</OPTION>
</SELECT>
&nbsp;
on all projects that:
<br><br>
<table>
<tr>
<td>Showed activity more recently than:</td>
<!-- The following scheme code snippet just inserts today's date,
  -- for example; it generates:
  -- <td><input type="text" name="earliest-end-date" size="12" value = "12 Dec 2007"></td> 
  -->
<?scm
(gtt-show (string-append 
	"<td><input type=\"text\" name=\"earliest-end-date\" size=\"12\" value = \""
	(date->string (time-utc->date now-day-time) "~d ~b ~Y")
	"\"></td>" ))
?>

</tr>
<tr>
<td>Showed activity no later than:</td>
<td><input type="text" name="latest-start-date" size="12"> </td>
</tr>
<tr>
<td> </td>
<td>
<!-- enable debug printing to stdout; handy for debugging this form. -->
<input type="hidden" name="debug" value="1">

<!-- This hard-to-read mish-mash is the actual SQL query 
  -  to be performed to generate the report. 
  -->
<input type="hidden" name="query" value="SELECT * FROM GttProjectId WHERE (GttProjectEarliet <= 'kvp://earliest-end-date') AND (GttProjectLatest >= 'kvp://latest-start-date');">

<input type="submit" value="Generate Report">
</td>
</tr>
</table>
</FORM>

Please note that this query generator is under development and is 
subject to change.  


<br><br>
That's all Folks!
</body>
</html>
